:root {
  --bg: #f5f7fa;
  --bg2: #e0e7ff;
  --card-bg: #ffffff;
  --primary: #2563eb;
  --primary-hover: #1e40af;
  --text: #1f2937;
  --muted: #6b7280;
  --radius: 12px;
  --ring: 0 0 0 3px rgba(37, 99, 235, 0.25);
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md: 0 2px 8px rgba(0,0,0,0.06);
  --shadow-lg: 0 6px 16px rgba(0,0,0,0.08);
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(var(--bg), var(--bg2));
  color: var(--text);
  line-height: 1.5;
}

.topbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(0,0,0,0.06);
}

.brand { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
.brand .logo { font-size: 1.25rem; color: var(--primary); }
.brand .title { font-weight: 700; letter-spacing: 0.2px; }
.topbar .hint { color: var(--muted); font-size: 0.9rem; margin-right: 0.5rem; }
#users-btn { font-weight: 600; }
.users-dropdown { position: relative; }
.users-menu { position: absolute; right: 0; top: calc(100% + 6px); background: #fff; border: 1px solid #e5e7eb; border-radius: var(--radius); box-shadow: var(--shadow-lg); width: 280px; padding: 0.5rem; z-index: 20; }
.users-menu-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.25rem; }
.user-list { display: flex; flex-direction: column; gap: 0.25rem; margin: 0; padding: 0; max-height: 240px; overflow-y: auto; }
.user-list li { list-style: none; display: flex; align-items: center; gap: 0.35rem; background: #eef2ff; color: #1e3a8a; border-radius: 999px; padding: 0.15rem 0.5rem; font-size: 0.85rem; }
.user-list li .name { flex: 1; cursor: pointer; }
.users-menu .icon-btn.small { padding: 0.15rem 0.35rem; }

.app {
  padding: 1rem;
  max-width: 720px;
  margin: 0 auto;
}

h1,
h2,
h3 {
  font-weight: 600;
  margin: 0 0 1rem;
  color: var(--primary);
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.card {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: none;
  padding: 1rem;
  margin-bottom: 1.5rem;
  border: 1px solid #e5e7eb;
}

.stack > * + * {
  margin-top: 0.75rem;
}

input,
select,
textarea,
button {
  font: inherit;
}

input,
select,
textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: var(--radius);
  background: #fff;
  box-shadow: var(--shadow-sm) inset;
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
}

textarea {
  min-height: 4rem;
  resize: vertical;
}

button {
  padding: 0.75rem 1rem;
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease;
}

button.primary {
  background: var(--primary);
  color: #fff;
  box-shadow: var(--shadow-md);
}

button.primary:hover {
  background: var(--primary-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-lg);
}

.back-btn {
  background: transparent;
  color: var(--muted);
  padding: 0.25rem 0.25rem;
  margin-bottom: 0.5rem;
  border-radius: var(--radius);
}

#case-list li,
#task-list li,
#notes-list li {
  padding: 0.75rem;
  border: 1px solid #e5e7eb;
  border-radius: var(--radius);
  margin-bottom: 0.5rem;
  background: #fff;
  box-shadow: none;
  transition: background 0.2s ease, transform 0.05s ease;
}

#case-list li {
  cursor: pointer;
  transition: background 0.2s;
}

#case-list li:hover {
  background: #f3f4f6;
  transform: translateY(-1px);
}

#task-form,
#note-form {
  margin-top: 1rem;
}

#task-form select {
  margin-top: 0.75rem;
}

/* Composer */
#task-form.composer { display: grid; grid-template-columns: auto 1fr auto; gap: 8px; align-items: center; border: 1px solid #e5e7eb; border-radius: 12px; padding: 8px; background: #fff; }
#task-form.composer input { border: none; box-shadow: none; padding: 0.5rem 0.25rem; height: 48px; }
#task-form.composer .primary { height: 48px; border-radius: 12px; padding: 0 14px; }
.composer-opts { display: grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: 8px; margin: 8px 0 12px; }
.composer-opts label { display: grid; gap: 4px; color: var(--muted); font-size: 0.9rem; }
.composer-opts select { width: 100%; }

/* Chips */
.chips { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
.chip { display: inline-flex; align-items: center; gap: 6px; height: 22px; padding: 0 8px; border: 1px solid #e5e7eb; border-radius: 9999px; font-size: 12px; color: #374151; background: #fff; }
.chip.pri-high { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
.chip.pri-medium { background: #fef3c7; color: #92400e; border-color: #fde68a; }
.chip.pri-low { background: #dbeafe; color: #1e3a8a; border-color: #bfdbfe; }
.avatar { width: 22px; height: 22px; border-radius: 9999px; background: #e5e7eb; color: #374151; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }

#notes-list li button {
  margin-left: 0.5rem;
  background: none;
  color: var(--primary);
  border-radius: var(--radius);
  padding: 0.25rem 0.5rem;
}

#task-list li {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: center;
  row-gap: 0.25rem;
  column-gap: 0.25rem;
}

.task-main { display: flex; align-items: center; gap: 0.35rem; min-width: 0; }
.task-title {
  font-weight: 500;
}
/* Title should truncate when needed next to status */
.task-main .task-title { flex: 1 1 auto; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

/* Checkbox-style status button */
.task-status-btn {
  font-size: 1.6rem;
  font-weight: 700;
  width: 2.2rem;
  height: 2.2rem;
  line-height: 2rem;
  text-align: center;
  padding: 0;
}

.task-actions {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  flex-wrap: wrap;
  justify-content: flex-end;
  max-width: 100%;
}

.task-actions select {
  flex: 0 0 auto;
  max-width: 7rem;
  min-width: 0;
}

.icon-btn {
  background: none;
  border: none;
  color: var(--primary);
  padding: 0.4rem 0.5rem;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background 0.15s ease, transform 0.05s ease;
  min-height: 36px;
}

.icon-btn:hover {
  background: #e0e7ff;
  transform: translateY(-1px);
}

.delete-btn {
  color: #ef4444;
}

.add-comment-btn {
  color: #10b981;
}

.status-select {
  border: none;
  border-radius: 999px;
  padding: 0.15rem 0.5rem;
  font-size: 0.8rem;
  font-weight: 600;
  text-transform: capitalize;
  box-shadow: var(--shadow-sm);
}

.status-select[data-status="open"] {
  background: #fee2e2;
  color: #991b1b;
}

.status-select[data-status="in progress"] {
  background: #fef3c7;
  color: #92400e;
}

.status-select[data-status="complete"] {
  background: #dcfce7;
  color: #166534;
}

.task-item[data-status="complete"] .task-title {
  text-decoration: line-through;
  color: var(--muted);
}


.task-item[data-status="open"] {
  border-left: 4px solid #3b82f6; /* blue */
  background: #eff6ff; /* lighter blue */
}

.task-item[data-status="in progress"] {
  border-left: 4px solid #f59e0b; /* amber */
  background: #fffbeb; /* softer amber */
}

.task-item[data-status="complete"] {
  border-left: 4px solid #34d399;
  background: #dcfce7;

}

.comment-section {
  margin-left: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  padding: 0.25rem 0.5rem;
  border-left: 2px dashed rgba(0,0,0,0.08);
  background: #f8fafc;
  border-radius: var(--radius);
}

/* Limit comment list height for compactness */
.comment-section .comments { max-height: 220px; overflow-y: auto; }

/* Inline comment actions */
.comments li { display: flex; align-items: center; gap: 0.25rem; }
.comments li > span { flex: 1 1 auto; min-width: 0; white-space: normal; overflow-wrap: anywhere; word-break: break-word; }
.comments .case-actions { display: inline-flex; gap: 0.25rem; margin-left: auto; }
.comments .icon-btn { padding: 0.15rem; }

/* Ensure the hidden attribute actually hides comment sections */
.comment-section[hidden] { display: none !important; }

.comments { font-size: 0.9rem; line-height: 1.35; }

.comments li {
  border: none;
  padding: 0.2rem 0;
}

.comment-form {
  display: flex;
  gap: 0.5rem;

}

.comment-form input {
  flex: 1;
  padding: 0.5rem;
  font-size: 0.9rem;
}

@media (min-width: 600px) {
  #case-form,
  #task-form {
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  #case-form input,
  #task-form input {
    flex: 1;
  }

  #task-form select {
    flex: 0 0 40%;
    margin-top: 0;
  }

  #case-form select {
    flex: 0 0 40%;
    margin-top: 0;
  }

  #case-form button,
  #task-form button {
    flex: 0 0 auto;
  }
}

/* Location chip styling on case card */
.chip.location { background: #e0f2fe; color: #075985; border-color: #bae6fd; cursor: pointer; }

/* Empty state helpers */
#case-list:empty::before {
  content: 'No cases yet. Add your first case.';
  display: block;
  color: var(--muted);
  font-size: 0.95rem;
}

#task-list:empty::before {
  content: 'No tasks yet. Add one above.';
  display: block;
  color: var(--muted);
  font-size: 0.95rem;
}

#notes-list:empty::before {
  content: 'No notes yet. Capture key details.';
  display: block;
  color: var(--muted);
  font-size: 0.95rem;
}

.comments:empty::before {
  content: 'No comments yet.';
  display: block;
  color: var(--muted);
  font-size: 0.9rem;
}

/* Optimistic and failure states for comments */
.comments li.optimistic { opacity: 0.6; font-style: italic; }
.comments li.failed { opacity: 1; color: #b91c1c; }

/* Focus rings for accessibility */
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
button:focus-visible {
  outline: none;
  box-shadow: var(--ring);
}

/* Tabs */
.tabs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0; margin-bottom: 0.75rem; border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; }
.tab { height: 44px; display: flex; align-items: center; justify-content: center; background: #fff; color: #374151; border-right: 1px solid #e5e7eb; }
.tab:last-child { border-right: none; }
.tab.active { background: var(--primary); color: #fff; }

/* Center main tabs (Table/My Tasks) */
#main-tabs { display: flex; justify-content: center; gap: 8px; border: none; }
#main-tabs .tab { border: 1px solid #e5e7eb; border-right: none; border-radius: 999px; padding: 0 14px; height: 40px; }
#main-tabs .tab.active { background: var(--primary); color: #fff; }

/* More compact task row on wider screens */
.task-main { grid-column: 1 / 2; }
.task-actions {
  grid-column: 2 / 3;
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  justify-self: end;
  max-width: 100%;
  white-space: nowrap;
}
.comment-section {
  grid-column: 1 / -1;
  margin-top: 0.25rem;
}

/* Heading flair */
.emoji { margin-right: 0.35rem; }
.case-heading { margin-top: 0.25rem; }
.change-user-link {
  font-size: 0.9rem;
  color: var(--muted);
  background: none;
  border: none;
  padding: 0;
  margin-left: 8px;
  cursor: pointer;
}
.change-user-link:hover { text-decoration: underline; color: #4b5563; }

/* User detail layout tweaks */

/* Clean, unified toolbar styles (used by React TaskToolbar in My Tasks and Case) */
.c-toolbar { display: flex; align-items: center; gap: 8px; padding: 8px; border: 1px solid #e5e7eb; border-radius: 12px; background: #fff; }
.c-toolbar--stack { flex-direction: column; gap: 6px; }
.c-row { display: flex; align-items: center; gap: 8px; width: 100%; }
.c-row--center { justify-content: center; gap: 12px; }
.c-row .c-field--grow { flex: 1 1 100%; }
.c-search { width: 100%; }
.c-select-btn { white-space: nowrap; }
.c-segments { display: inline-flex; align-items: center; border: 1px solid #e5e7eb; border-radius: 999px; overflow: hidden; }
.c-chip { height: 36px; padding: 0 12px; font-size: 14px; border: none; cursor: pointer; }
.c-chip--inactive { background: #eef2ff; color: #2563eb; }
.c-chip--active { background: #2563eb; color: #fff; }
.c-chip--sep { border-right: 1px solid #e5e7eb; }
.c-field { display: flex; align-items: center; gap: 6px; color: #374151; }
.c-select { position: relative; }
.c-select select { height: 36px; padding: 0 28px 0 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; color: #111827; appearance: none; }
.c-select-btn { height: 36px; padding: 0 28px 0 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; color: #111827; cursor: pointer; }
.c-select--wide select { min-width: 180px; }
.c-caret { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #6b7280; pointer-events: none; }
.c-select--multi .c-caret { right: 8px; }
.c-menu { position: absolute; top: calc(100% + 4px); left: 0; z-index: 40; min-width: 220px; background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: var(--shadow-lg); padding: 6px; }
.c-menu-item { display: grid; grid-template-columns: 16px 1fr; align-items: center; gap: 8px; padding: 6px 4px; border-radius: 6px; font-size: 14px; cursor: pointer; }
.c-menu-item:hover { background: #f9fafb; }
.c-menu-item input[type="checkbox"] { width: 14px; height: 14px; }
.c-field--grow { flex: 1 1 220px; }
.c-input { height: 36px; width: 100%; padding: 0 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; color: #111827; }
.c-input--search { padding-right: 28px; }
.c-btn { height: 36px; padding: 0 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; color: #111827; }
.c-btn:hover, .c-select select:hover, .c-input:hover { background: #f9fafb; }
.c-btn:focus-visible, .c-select select:focus-visible, .c-input:focus-visible, .c-chip:focus-visible { outline: none; box-shadow: var(--ring); }

/* Search with built-in clear */
.c-search { position: relative; }
.c-clear { position: absolute; right: 4px; top: 50%; transform: translateY(-50%); height: 24px; width: 24px; border: 1px solid #e5e7eb; border-radius: 999px; background: #fff; color: #6b7280; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; }
.c-clear:hover { background: #f3f4f6; }

/* Simplify My Tasks rows: align left [status][title], push right-side controls */
#user-task-list .case-task { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 10px; border: 1px solid #eee; background: #fff; }
#user-task-list .case-task:hover { background: #f9fafb; }
#user-task-list .case-task .mini-avatar { margin-left: auto; }
#user-task-list .case-task .comment-toggle { margin-left: 8px; }
#user-task-list .case-task .badge.comment-count { margin-left: 2px; }
/* Tone down status color blocks to reduce noise */
#user-task-list .case-task.s-open, 
#user-task-list .case-task.s-inprogress, 
#user-task-list .case-task.s-complete { border-left: 0; background: #fff; }
#user-task-list .case-task.s-complete .task-text { color: #6b7280; text-decoration: line-through; }

/* Remove decorative bracket effect from groups (no extra decorations) */
#user-task-list > .user-case-card ul { margin: 0; padding-left: 0; }
.user-case-card { border: 1px solid #e5e7eb; }
.user-case-header { padding-bottom: 4px; }
.user-case-card { margin-bottom: 0.75rem; }
.user-case-header { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; margin-bottom: 0.25rem; }
.user-case-header h3 { margin: 0; }
#user-task-list > .user-case-card ul { margin: 0; padding-left: 1rem; }
.toolbar { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
.toolbar .filter-group { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
.toolbar .meta { color: var(--muted); font-size: 0.9rem; }
.link-btn { background: none; border: none; color: var(--primary); padding: 0; cursor: pointer; font-weight: 600; }
.link-btn:hover { text-decoration: underline; }
.badge {
  background: #eef2ff;
  color: #3730a3;
  border-radius: 999px;
  padding: 0.05rem 0.4rem;
  font-size: 0.8rem;
  font-weight: 600;
}

/* Case list item actions */
.case-item { display: block; }
.case-item-header { display: flex; align-items: center; justify-content: space-between; gap: 0.5rem; }
#case-list li.case-item .case-left { display: flex; align-items: center; gap: 6px; }
#case-list li.case-item .case-title { flex: 1 1 auto; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#case-list li.case-item .case-actions { display: flex; gap: 0.25rem; align-items: center; }
.case-subinfo-left { display: flex; align-items: center; gap: 6px; }
.case-id { color: var(--muted); font-size: 0.9rem; }
.chev-btn { background: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2px 6px; color: #374151; line-height: 1; }

/* Compact tasks under case card */
.case-tasks-wrap { width: 100%; margin-top: 6px; }
.case-tasks { margin: 0; padding-left: 0; display: flex; flex-direction: column; gap: 8px; }
.case-task { display: flex; align-items: center; gap: 8px; font-size: 0.95rem; color: #374151; padding: 8px 12px; border-radius: 12px; position: relative; flex-wrap: wrap; }
.case-task .task-text { flex: 1 1 auto; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.case-task .status { font-weight: 700; width: 1.25rem; text-align: center; color: #1f2937; }
.case-task .status-btn {
  background: none;
  border: none;
  cursor: pointer;
  font-weight: 700;
  color: #1f2937;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  font-size: 22px;
}

/* Larger tap targets on small screens */
@media (max-width: 600px) {
  .case-task .status-btn {
    width: 44px;
    height: 44px;
    font-size: 28px;
  }
  .task-status-btn {
    width: 44px;
    height: 44px;
    line-height: 42px;
    font-size: 1.9rem;
  }
}

/* Remove redundant Cases header; tab label provides context */
#case-list-section > h1 { display: none; }
.case-task .mini-chip { font-size: 12px; padding: 0 8px; height: 20px; display: inline-flex; align-items: center; border: 1px solid #e5e7eb; border-radius: 9999px; color: #374151; }
.case-task .mini-avatar { width: 22px; height: 22px; border-radius: 9999px; background: #e5e7eb; color: #374151; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; cursor: pointer; margin-left: 6px; }
.case-tasks-toggle { background: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2px 6px; color: #374151; }
.case-tasks-more { background: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2px 6px; color: #374151; margin-top: 6px; }
.case-tasks-more { background: none; border: 1px solid #e5e7eb; border-radius: 8px; padding: 2px 6px; color: #374151; margin-top: 6px; }

/* Tasteful status-based color coding for compact case tasks (override #case-list li background) */
#case-list .case-task.s-open { border-left: 3px solid #3b82f6; background: #f2f7ff; }
#case-list .case-task.s-inprogress { border-left: 3px solid #f59e0b; background: #fff7ea; }
#case-list .case-task.s-complete { border-left: 3px solid #34d399; background: #effdf5; }
#case-list .case-task.s-complete .task-text { color: #6b7280; text-decoration: line-through; }

/* Minimal inline comments under compact tasks */
.case-mini-comments { font-size: 0.85rem; color: #6b7280; margin: 2px 0 0 18px; /* indent under icon */ flex: 0 0 100%; width: 100%; display: block; padding-right: 8px; box-sizing: border-box; }
.case-mini-comments .c-line { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: calc(100% - 8px); }
.case-mini-comments .c-author { font-weight: 600; color: #4b5563; margin-right: 6px; }

/* Assignee popup and tooltip */
.assignee-panel {
  position: absolute;
  right: 0;
  top: 100%;
  margin-top: 4px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  box-shadow: var(--shadow-md);
  min-width: 160px;
  padding: 4px;
  z-index: 9998;
}
.assignee-option { display: block; width: 100%; text-align: left; background: none; border: none; padding: 8px 10px; border-radius: 6px; color: var(--text); cursor: pointer; }
.assignee-option:hover { background: #f3f4f6; }
.assignee-tip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 6px;
  background: #111827;
  color: #fff;
  padding: 4px 6px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
  z-index: 9999;
}

/* Toast notifications */
.toast-container {
  position: fixed;
  bottom: 1rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  z-index: 1000;
}

/* Table view */
.table-root { overflow-x: auto; }
.data-table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 720px; }
.data-table { table-layout: fixed; }
.data-table th, .data-table td { border: 1px solid #e5e7eb; padding: 8px; background: #fff; }
.data-table th { background: #f9fafb; text-align: left; font-weight: 600; }
.data-table td .cell-edit { width: 100%; min-width: 140px; border: 1px solid transparent; border-radius: 8px; padding: 8px 10px; }
.data-table td .cell-edit:focus { outline: none; border-color: #bfdbfe; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
.cell-editable {
  display: block;
  width: 100%;
  min-height: 36px;
  line-height: 1.4;
  white-space: pre-wrap;        /* preserve newlines, wrap long lines */
  overflow-wrap: anywhere;      /* wrap long words */
  border: 1px solid transparent;
  border-radius: 8px;
  padding: 8px 10px;
}
.cell-editable:focus {
  outline: none;
  border-color: #bfdbfe;
  box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
}
/* Placeholder for empty contenteditable */
.cell-editable[contenteditable="true"]:empty:before {
  content: attr(data-placeholder);
  color: #9ca3af; /* muted */
}
.patient-link { background: none; border: none; color: var(--primary); cursor: pointer; font-weight: 600; padding: 0; }
.patient-link:hover { text-decoration: underline; }

/* Tasks cell inside the table */
.cell-tasks {
  max-height: 320px; /* ~8 rows visible */
  overflow-y: auto;
  display: block;
  padding: 2px 0;
}
.cell-tasks ul { list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 4px; }
.cell-tasks ul { max-height: 260px; overflow-y: auto; }
.cell-tasks .case-task { padding: 4px 6px; border-radius: 4px; }
#table-section .cell-tasks .case-task { align-items: flex-start; }
.cell-tasks .status-btn { width: 16px; height: 16px; font-size: 14px; padding: 0; }
.cell-tasks .mini-avatar { width: 16px; height: 16px; font-size: 10px; }
.cell-tasks .composer { display: grid; grid-template-columns: 1fr; gap: 4px; margin-top: 6px; }
.cell-tasks .composer input { flex: 1; padding: 4px 8px 4px 18px; height: 26px; border-radius: 4px; font-size: 13px; }
.cell-tasks .composer.compact { position: relative; }
.cell-tasks .composer.compact::before {
  content: '+';
  position: absolute;
  left: 6px;
  top: 50%;
  transform: translateY(-50%);
  color: #6b7280;
  font-weight: 600;
  font-size: 14px;
}

/* Compact professional look only in table section */
#table-section { font-size: 13px; line-height: 1.35; }
#table-section .data-table th, #table-section .data-table td { padding: 4px 6px; }
#table-section .data-table th:nth-child(1),
#table-section .data-table td:nth-child(1) { width: clamp(140px, 18%, 210px); }
#table-section .data-table th:nth-child(2),
#table-section .data-table td:nth-child(2),
#table-section .data-table th:nth-child(3),
#table-section .data-table td:nth-child(3),
#table-section .data-table th:nth-child(4),
#table-section .data-table td:nth-child(4),
#table-section .data-table th:nth-child(5),
#table-section .data-table td:nth-child(5),
#table-section .data-table th:nth-child(6),
#table-section .data-table td:nth-child(6) { width: clamp(100px, 8%, 150px); }
#table-section .data-table th:nth-child(7),
#table-section .data-table td:nth-child(7) { width: clamp(260px, 35%, 390px); }
#table-section .cell-editable, #table-section .cell-tasks .composer input { border-radius: 4px; }
/* Allow wrapping long task text inside the Table's tasks cell */
#table-section .cell-tasks .case-task .task-text {
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
  overflow-wrap: anywhere;
  word-break: break-word;
  line-height: 1.3;
}
/* Make the delete button in Table tasks subtle and compact */
#table-section .cell-tasks .icon-btn.delete-btn {
  width: 16px;
  height: 16px;
  padding: 0;
  font-size: 12px;
  line-height: 1;
  border: none;
  background: transparent;
  opacity: 0.45;
  margin-left: 4px;
}
#table-section .cell-tasks .icon-btn { min-height: 0; }
#table-section .cell-tasks .case-task:hover .icon-btn.delete-btn { opacity: 0.8; }
#table-section .cell-tasks .case-task .icon-btn.delete-btn { visibility: hidden; }
#table-section .cell-tasks .case-task:hover .icon-btn.delete-btn { visibility: visible; }
#table-section .cell-editable:focus { box-shadow: 0 0 0 2px rgba(59,130,246,0.18); }
#table-section .data-table tbody tr:nth-child(even) td { background: #fafafa; }
#table-section .data-table th { font-size: 13px; font-weight: 600; }

/* Tag controls bar */
.tags-controls { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 6px; padding: 6px 8px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 8px; }
.tags-controls .left, .tags-controls .right { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.tags-controls .ctrl { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #374151; }
.tags-controls select { min-width: 140px; height: 28px; padding: 2px 6px; border-radius: 4px; border: 1px solid #e5e7eb; background: #fff; font-size: 12px; }

/* Modern pill filters */
.filter-pill { height: 28px; padding: 0 10px; border: 1px solid #e5e7eb; border-radius: 999px; background: #fff; color: #111827; font-size: 12px; display: inline-flex; align-items: center; gap: 6px; cursor: pointer; }
.filter-pill[aria-disabled="true"] { opacity: 0.5; cursor: not-allowed; }
.filter-pill .count { color: #6b7280; }
.filter-chips { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.section-label { color: #6b7280; font-size: 12px; margin-right: 6px; }
.filter-chip { display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px; border: 1px solid #e5e7eb; background: #fff; font-size: 12px; }
.filter-chip .x { cursor: pointer; color: #6b7280; }

.filter-popover { position: absolute; z-index: 50; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: var(--shadow-lg); width: min(320px, 92vw); padding: 6px; }
.filter-popover .search { width: 100%; height: 28px; border: 1px solid #e5e7eb; border-radius: 6px; padding: 2px 8px; font-size: 12px; margin-bottom: 6px; }
.filter-popover .list { max-height: 260px; overflow: auto; display: grid; gap: 2px; }
.filter-popover .opt { display: flex; align-items: center; justify-content: space-between; gap: 8px; padding: 6px 8px; border-radius: 6px; cursor: pointer; }
.filter-popover .opt:hover { background: #f9fafb; }
.filter-popover .opt .label { display: inline-flex; align-items: center; gap: 8px; margin: 0; flex: 1 1 auto; min-width: 0; }
.filter-popover .opt .label span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.filter-popover .opt .opt-count { color: #6b7280; font-variant-numeric: tabular-nums; min-width: 2ch; text-align: right; }

/* Reset generic input styles for checkboxes inside popovers/sheets */
.filter-popover input[type="checkbox"],
.sheet input[type="checkbox"] {
  width: 14px;
  height: 14px;
  padding: 0;
  border: 1px solid #9ca3af;
  border-radius: 3px;
  background: #fff;
  box-shadow: none;
}

/* Segmented sort */
.segmented { display: inline-flex; border: 1px solid #e5e7eb; border-radius: 999px; overflow: hidden; }
.segmented button { height: 28px; padding: 0 10px; border: none; background: #fff; font-size: 12px; cursor: pointer; }
.segmented button.active { background: #1d4ed8; color: #fff; }
.segmented .sep { width: 1px; background: #e5e7eb; }
.sort-dir { height: 28px; padding: 0 8px; border: 1px solid #e5e7eb; border-radius: 999px; background: #fff; font-size: 12px; }

/* Hide legacy selects in the table filter bar */
#table-tags-controls select { display: none; }

/* Mobile filters button */
.mobile-filters-btn { display: none; height: 28px; padding: 0 10px; border: 1px solid #e5e7eb; border-radius: 999px; background: #fff; font-size: 12px; }
.pills-wrap { display: inline-flex; gap: 8px; flex-wrap: wrap; align-items: center; }
@media (max-width: 640px) {
  .pills-wrap { display: none; }
  .mobile-filters-btn { display: inline-flex; align-items: center; }
}

/* Bottom sheet */
.sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 60; }
.sheet { position: fixed; left: 0; right: 0; bottom: 0; background: #fff; border-top-left-radius: 16px; border-top-right-radius: 16px; box-shadow: var(--shadow-lg); padding: 12px; z-index: 61; }
.sheet h4 { margin: 6px 0; font-size: 14px; }
.sheet .section { margin-bottom: 10px; }
.sheet .actions { display: flex; justify-content: space-between; gap: 8px; }

/* New case footer at bottom of table */
.new-case-footer { display: flex; justify-content: center; padding: 10px 8px; }
.name-cell { display: flex; flex-direction: column; gap: 2px; }
.name-row { display: flex; align-items: center; gap: 6px; }
.tag-chips { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; font-size: 12px; color: #374151; }
.tag-chip { display: inline-flex; align-items: center; gap: 4px; padding: 1px 6px; border-radius: 999px; background: #eef2ff; color: #1e3a8a; border: 1px solid #e5e7eb; }
.tag-order { color: #6b7280; font-weight: 600; }
.edit-tags-btn { background: none; border: 1px solid #e5e7eb; border-radius: 4px; padding: 2px 6px; font-size: 12px; color: #374151; }
.tag-panel { position: fixed; z-index: 2147483646; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: var(--shadow-md); padding: 8px; width: 280px; }
.tag-panel h4 { margin: 0 0 6px; font-size: 13px; }
.tag-panel .row { display: grid; gap: 6px; margin-bottom: 6px; }
.tag-panel select { width: 100%; height: 32px; border-radius: 6px; border: 1px solid #e5e7eb; }
.tag-panel .actions { display: flex; justify-content: flex-end; gap: 6px; }

/* Show/Hide filters control */
.show-filters-btn { font-size: 12px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 6px; background: #fff; }

/* Table controls */
/* Print action button inline with card header area */
#table-section { position: relative; }
.filters-placeholder { display: flex; align-items: center; justify-content: flex-end; gap: 8px; margin-bottom: 6px; padding: 6px 8px; }
.print-action { position: absolute; top: 6px; right: 8px; font-size: 12px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 6px; background: #fff; }

/* Print mode (screen) */
body.print-mode .topbar,
body.print-mode #main-tabs { display: none !important; }
body.print-mode .print-action { display: none !important; }
body.print-mode .patient-link { pointer-events: none; color: inherit; text-decoration: none; cursor: default; }
body.print-mode #table-section { font-size: 12px; line-height: 1.3; padding: 0; border: none; border-radius: 0; }
body.print-mode #table-section .data-table th, body.print-mode #table-section .data-table td { padding: 2px 4px; }
body.print-mode #table-section .cell-tasks .composer,
body.print-mode #table-section input,
body.print-mode #table-section textarea { display: none !important; }
body.print-mode #table-section .status-btn,
body.print-mode #table-section .mini-avatar,
body.print-mode #table-section .icon-btn,
body.print-mode #table-section .assignee-panel { display: none !important; }

/* Print stylesheet */
@media print {
  .topbar, #main-tabs, .print-action { display: none !important; }
  .app { padding: 0; max-width: none; }
  #table-section { padding: 0; margin: 0; border: none; box-shadow: none; }
  /* Reset full-bleed hacks for print */
  #table-section { position: static; left: 0; right: 0; width: auto; }
  thead { display: table-header-group; }
  tr, td, th { page-break-inside: avoid; }
  /* Hide interactive elements */
  #table-section .cell-tasks .composer,
  #table-section input,
  #table-section textarea,
  #table-section .status-btn,
  #table-section .mini-avatar,
  #table-section .icon-btn,
  #table-section .assignee-panel { display: none !important; }
  /* Make patient link look like text */
  .patient-link { pointer-events: none; color: inherit; text-decoration: none; }
  /* Extra compact spacing for print */
  #table-section { font-size: 12px; line-height: 1.3; }
  #table-section .data-table th, #table-section .data-table td { padding: 2mm 3mm; }
}

/* Make only the Table section full-width on desktop */
@media (min-width: 900px) {
  #table-section {
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    width: 100vw;
    border-left: none;
    border-right: none;
    border-radius: 0;
  }
  #table-section .table-root {
    max-width: 1320px; /* content width inside full-bleed section */
    margin: 0 auto;
    padding: 0 16px;
  }
}

/* Flash highlight for focused task */
@keyframes flash-highlight {
  0% { box-shadow: 0 0 0 0 rgba(59,130,246,0.0); background-color: inherit; }
  10% { box-shadow: 0 0 0 4px rgba(59,130,246,0.25); background-color: #eef2ff; }
  100% { box-shadow: 0 0 0 0 rgba(59,130,246,0.0); background-color: inherit; }
}
.flash-highlight { animation: flash-highlight 1200ms ease-out 1; }

/* Responsive header layout for small screens */
@media (max-width: 600px) {
  #case-list li.case-item .case-title { flex: 1 1 100%; white-space: normal; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
  .case-item-header { flex-wrap: wrap; }
  .case-subinfo-left { order: 2; flex: 1 1 auto; }
  #case-list li.case-item .case-actions { order: 2; margin-left: auto; }
  /* Hide the redundant Cases header on mobile */
  #case-list-section > h1 { display: none; }
  /* Make the title container span full width */
  .case-item-header > .case-left { flex: 1 1 100%; min-width: 0; }
}

.toast {
  background: #111827;
  color: #ffffff;
  padding: 0.5rem 0.75rem;
  border-radius: 0.5rem;
  box-shadow: var(--shadow-lg);
  font-size: 0.9rem;
  opacity: 0;
  transform: translateY(8px);
  animation: toast-in 120ms ease-out forwards, toast-out 300ms ease-in forwards 2.8s;
}

@keyframes toast-in {
  to { opacity: 1; transform: translateY(0); }
}
@keyframes toast-out {
  to { opacity: 0; transform: translateY(8px); }
}

/* Modal for user selection */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}
.modal {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 16px;
  width: min(92vw, 420px);
  box-shadow: 0 10px 24px rgba(0,0,0,0.12);
}
.modal h3 { margin: 0 0 8px; color: var(--text); font-weight: 600; }
.modal .row { display: grid; gap: 8px; margin-bottom: 12px; }
.modal .actions { display: flex; justify-content: flex-end; gap: 8px; }
.btn { height: 48px; padding: 0 14px; border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; cursor: pointer; }
.btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
.comment-count { margin-left: 0.15rem; }

/* Tags manager modal */
.tags-manager { width: min(92vw, 820px); }
.tags-manager .tabs { grid-template-columns: 1fr 1fr; margin-bottom: 8px; }
.tags-manager .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.tags-list, .rooms-list { border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px; max-height: 360px; overflow-y: auto; }
.tags-list h4, .rooms-list h4 { margin: 0 0 6px; font-size: 14px; }
.entry { display: flex; align-items: center; justify-content: space-between; gap: 6px; border: 1px solid #f3f4f6; border-radius: 6px; padding: 4px 6px; margin-bottom: 6px; }
.entry .name { font-size: 13px; }
.entry .row-actions { display: inline-flex; gap: 4px; }
.entry .row-actions button { font-size: 12px; padding: 2px 6px; border: 1px solid #e5e7eb; border-radius: 6px; background: #fff; }
.section-actions { display: flex; justify-content: flex-end; gap: 6px; margin-top: 6px; }

/* Overflow-safe comments */
.comments li { align-items: flex-start; }
.comments li > span { line-height: 1.45; }

/* Simple actions menu */
.actions-menu { position: relative; }
.menu-panel {
  position: absolute; right: 0; top: 100%; margin-top: 4px;
  background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: var(--shadow-md);
  min-width: 160px; padding: 4px; z-index: 30;
}
.menu-item { display: block; width: 100%; text-align: left; background: none; border: none; padding: 8px 10px; border-radius: 6px; color: var(--text); }
.menu-item:hover { background: #f3f4f6; }

/* Ensure case page color coding has priority */
/* Compact color coding on case page task list */
#task-list .case-task.s-open { border-left: 3px solid #3b82f6; background: #f2f7ff; }
#task-list .case-task.s-inprogress { border-left: 3px solid #f59e0b; background: #fff7ea; }
#task-list .case-task.s-complete { border-left: 3px solid #34d399; background: #effdf5; }
#task-list .case-task.s-complete .task-text { color: #6b7280; text-decoration: line-through; }

/* Compact color coding on My Tasks list */
#user-task-list .case-task.s-open { border-left: 3px solid #3b82f6; background: #f2f7ff; }
#user-task-list .case-task.s-inprogress { border-left: 3px solid #f59e0b; background: #fff7ea; }
#user-task-list .case-task.s-complete { border-left: 3px solid #34d399; background: #effdf5; }
#user-task-list .case-task.s-complete .task-text { color: #6b7280; text-decoration: line-through; }


/* Controls row above case list */
.controls-row { display: flex; align-items: center; justify-content: flex-end; gap: 8px; margin: 8px 0 16px; }
.controls-group { display: flex; gap: 8px; }
.case-tasks-toggle { padding: 8px 12px; border-radius: 12px; font-size: 0.95rem; }
@media (max-width: 600px) {
  .controls-row { margin: 12px 0 20px; }
  .case-tasks-toggle { height: 44px; min-width: 44px; font-size: 1rem; }
}

/* Larger touch targets for per-case controls */
.chev-btn { background: none; border: 1px solid #e5e7eb; border-radius: 12px; padding: 0; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; font-size: 18px; }
@media (max-width: 600px) {
  .chev-btn { width: 44px; height: 44px; font-size: 22px; }
}
.case-actions .icon-btn { width: 36px; height: 36px; padding: 0; display: inline-flex; align-items: center; justify-content: center; }
@media (max-width: 600px) {
  .case-actions .icon-btn { width: 44px; height: 44px; font-size: 20px; }
}
/* Header right controls */
.header-right { display: flex; align-items: center; gap: 8px; }
.icon-btn.small { font-size: 12px; padding: 4px 8px; border: 1px solid #e5e7eb; border-radius: 6px; }

/* Print header inside print window */
.print-header { font-size: 12px; color: #111827; margin: 8px 0 6px; padding-bottom: 4px; border-bottom: 1px solid #e5e7eb; }
#case-detail .tabs {
  position: sticky;
  top: 56px; /* below sticky topbar */
  z-index: 6;
  background: #fff;
  padding-top: 4px;
  /* Full-width segmented control with two equal columns */
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  width: 100%;
  margin: 0 auto;
}

.case-header-actions { position: relative; display: inline-block; margin-left: 8px; }
.case-overflow-btn { font-weight: 600; }
.case-overflow-panel { position: absolute; right: 0; top: calc(100% + 6px); z-index: 30; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: var(--shadow-lg); padding: 6px; min-width: 160px; }
.case-overflow-panel[hidden] { display: none; }
.case-overflow-item { display: block; width: 100%; text-align: left; background: none; border: none; padding: 8px 10px; border-radius: 6px; color: var(--text); cursor: pointer; }
.case-overflow-item.delete { color: #ef4444; }

/* Case tag chips under title */
#case-tag-chips { margin: 6px 0 8px; }
